# Ø§Ù„Ù…Ù„Ù: restart_plugin.py
# Ø­Ù‚ÙˆÙ‚: Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø© Ø¹Ø§Ø´Ù‚ Ø§Ù„ØµÙ…Øª
# Ø³ÙˆØ±Ø³ ÙŠÙ…Ù†Ø«ÙˆÙ† - Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø³

import os
import sys
import asyncio
import time
from .. import zedub 
from ..core.managers import edit_or_reply

@zedub.zed_cmd(pattern=r"(Ø§Ø¹Ø§Ø¯Ù‡ ØªØ´ØºÙŠÙ„|Ø§Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„|Ø§Ø¹Ø§Ø¯Ù‡ Ø§Ù„ØªØ´ØºÙŠÙ„|Ø§Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„)$")
async def restart_ymthon(event):
    restart_steps = [
        {"percent": 10, "message": "Ø¬Ù€Ø§Ø±ÙŠ Ø¥Ø¹Ù€Ø§Ø¯Ø© ØªØ´ØºÙŠÙ€Ù„ Ø§Ù„Ø³Ù€ÙˆØ±Ø³.. ğŸŒ", "bar": "â–°â–±â–±â–±â–±â–±â–±â–±â–±"},
        {"percent": 20, "message": "Ø¬Ù€Ø§Ø±ÙŠ Ø¥ØºÙ„Ù€Ø§Ù‚ Ø§Ù„Ø§ØªØµÙ€Ø§Ù„Ø§Øª.. ğŸ“¡", "bar": "â–°â–°â–±â–±â–±â–±â–±â–±â–±"},
        {"percent": 30, "message": "Ø¬Ù€Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.. ğŸ’¾", "bar": "â–°â–°â–°â–±â–±â–±â–±â–±â–±"},
        {"percent": 40, "message": "Ø¬Ù€Ø§Ø±ÙŠ Ø¥ÙŠÙ‚Ù€Ø§Ù Ø§Ù„ÙˆØ­Ù€Ø¯Ø§Øª.. âš™ï¸", "bar": "â–°â–°â–°â–°â–±â–±â–±â–±â–±"},
        {"percent": 50, "message": "Ø¬Ù€Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ€Ù„ Ø§Ù„Ù…Ù„ÙÙ€Ø§Øª.. ğŸ“‚", "bar": "â–°â–°â–°â–°â–°â–±â–±â–±â–±"},
        {"percent": 60, "message": "Ø¬Ù€Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ù€Ø© Ø§Ù„Ù†Ø¸Ù€Ø§Ù….. ğŸ”§", "bar": "â–°â–°â–°â–°â–°â–°â–±â–±â–±"},
        {"percent": 70, "message": "Ø¬Ù€Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ€Ù„ Ø§Ù„Ø®Ø¯Ù…Ù€Ø§Øª.. ğŸ› ï¸", "bar": "â–°â–°â–°â–°â–°â–°â–°â–±â–±"},
        {"percent": 80, "message": "Ø¬Ù€Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù€Ù‚ Ù…Ù† Ø§Ù„Ù‚Ù€ÙˆØ§Ø¹Ø¯.. ğŸ“Š", "bar": "â–°â–°â–°â–°â–°â–°â–°â–°â–±"},
        {"percent": 90, "message": "Ø¬Ù€Ø§Ø±ÙŠ ØªÙ†Ø´Ù€ÙŠØ· Ø§Ù„Ù†Ø¸Ù€Ø§Ù….. âš¡", "bar": "â–°â–°â–°â–°â–°â–°â–°â–°â–°"},
        {"percent": 100, "message": "ØªÙ…Ù€Øª Ø§Ù„Ø¹Ù…Ù„ÙŠÙ€Ø© Ø¨Ù†Ø¬Ù€Ø§Ø­! âœ…", "bar": "â–°â–°â–°â–°â–°â–°â–°â–°â–°â–°"}
    ]

    msg = await edit_or_reply(event, "**âˆ Ø¨Ø¯Ø¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„.. ğŸŒ€**")
    
    for step in restart_steps:
        progress_text = (
            f"ğ“†© [ğ™ğ™Šğ™ğ™ğ˜¾ğ ğ™”ğ˜¼ğ™ˆğ™€ğ™‰ğ™ğ™ƒğ™Šğ™‰](t.me/YamenThon) ğ“†ª\n"
            f"**{step['message']}**\n\n"
            f"â” **Ø§Ù„ØªÙ‚Ø¯Ù…:** {step['percent']}%\n"
            f"â” **Ø§Ù„Ø­Ø§Ù„Ø©:** `{step['bar']}`\n\n"
            f"**âˆ Ø§Ù„Ø±Ø¬Ù€Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ù€Ø§Ø±..** ââ³â "
        )
        await msg.edit(progress_text)
        await asyncio.sleep(0.8)

    success_msg = (
        f"ğ“†© [ğ™ğ™Šğ™ğ™ğ˜¾ğ ğ™”ğ˜¼ğ™ˆğ™€ğ™‰ğ™ğ™ƒğ™Šğ™‰](t.me/YamenThon) ğ“†ª\n\n"
        f"**âˆ ØªÙ… Ø¥Ø¹Ù€Ø§Ø¯Ø© ØªØ´ØºÙŠÙ€Ù„ Ø§Ù„Ø³Ù€ÙˆØ±Ø³ Ø¨Ù†Ø¬Ù€Ø§Ø­! ğŸ‰**\n\n"
        f"â” **Ø§Ù„Ø­Ø§Ù„Ø©:** `âœ… ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨Ù†Ø¬Ø§Ø­`\n"
        f"â” **Ø§Ù„ÙˆÙ‚Øª:** `{time.strftime('%H:%M:%S')}`\n\n"
        f"**âˆ ØªØªÙ… Ø§Ù„Ø§Ù† Ø¹Ù…Ù„ÙŠÙ‡ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù†ØªØ¸Ø± 5 Ø¯Ù‚Ø§Ø¦Ù‚** âœ¨"
    )
    
    await msg.edit(success_msg)
    await asyncio.sleep(2)

    # Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø³ ÙØ¹Ù„ÙŠÙ‹Ø§
    os.execl(sys.executable, sys.executable, "-m", "yamenthon")
